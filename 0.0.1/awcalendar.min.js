class awCalendar extends HTMLElement{constructor(e,t){super(),this.event_options=["offDays","startDate","endDate","eventLoad","eventSave","backgroundImg","backgroundColor","eventModal","SetData","SelectDate","ChangeCal","EventUpdate","EventAdd","EventDelete","setToday","setMonth","setYear"],this.event_arr=[],this.date=new Date,this.today=new Date,this.date.setHours(24,0,0,0),this.options={},this.new_options={},document.querySelector(e).append(this),t&&Object.keys(t).forEach((e,a)=>{this.setData(e,t[e])})}dateFormat=(e,t)=>{var a={M:e.getMonth()+1,d:e.getDate(),h:e.getHours(),m:e.getMinutes(),s:e.getSeconds()};return(t=t.replace(/(M+|d+|h+|m+|s+)/g,function(e){return((e.length>1?"0":"")+a[e.slice(-1)]).slice(-2)})).replace(/(y+)/g,function(t){return e.getFullYear().toString().slice(-t.length)})};setData(e,t){return!!this.event_options.includes(e)&&(this.options[e]=t,this.new_options[e]=t,this.dispatchEvent(new CustomEvent(e,{detail:t,bubbles:!0,composed:!0})),this.setAttribute(e,t))}on=(e,t)=>{"*"==e.trim()?Object.values(this.event_options).forEach(e=>{this.addEventListener(e.trim(),t)}):e.split(",").forEach(e=>{this.addEventListener(e.trim(),t)})};request=(e,t,a)=>new Promise(function(n,r){let o=new XMLHttpRequest;o.onload=()=>n({status:xhr.status,response:xhr.responseText}),o.onerror=()=>r({status:xhr.status,response:xhr.responseText}),o.open(e,t),o.send(JSON.stringify(a))});setToday=e=>{this.today=new Date(e),this.querySelectorAll(".cal-days>div").forEach(t=>{new Date(t.date).toDateString()==new Date(e).toDateString()?t.classList.add("today"):t.classList.remove("today")}),this.dispatchEvent(new CustomEvent("setToday",{detail:{data:this.today},bubbles:!0,composed:!0}))};isOffday=e=>!!Object.values(this.querySelectorAll(".cal-days>div.offday")).filter((t,a)=>new Date(e).toDateString()===new Date(t.date).toDateString())[0];isToday=e=>new Date(e).toDateString()===new Date(this.today).toDateString();isEvent=e=>{let t=Object.values(this.querySelectorAll(".cal-days>div.events")).filter((t,a)=>new Date(e).toDateString()===new Date(t.date).toDateString());return t[0]&&t[0].events?t[0].events:[]};setMonth=e=>(this.date.getMonth()!=parseInt(e)&&(this.date.setMonth(parseInt(e)),this.dispatchEvent(new CustomEvent("setMonth",{detail:{data:this.today},bubbles:!0,composed:!0}))),this.date.getMonth());setYear=e=>(this.date.getFullYear()!=parseInt(e)&&(this.date.setFullYear(parseInt(e)),this.dispatchEvent(new CustomEvent("setYear",{detail:{data:this.today},bubbles:!0,composed:!0}))),this.date.getFullYear());getMonth=()=>this.date.getMonth();getYear=()=>this.date.getFullYear();getDate=()=>this.date;getToday=()=>this.today;prenxtDisableDays=(e,t)=>{this.querySelectorAll(".cal-days>div").forEach(a=>{new Date(a.date)<new Date(e)&&a.classList.add("disableday"),new Date(a.date)>new Date(t)&&a.classList.add("disableday")})};evtAdd=e=>{let t=this;if(!e)return console.error("Event Data Error!");if(!e.date)return console.error("Event date Error!");if(!e.title)return console.error("Event title Error!");if(!e.description)return console.error("Event description Error!");let a={date:new Date(e.date),title:e.title,description:e.description,type:e.type?e.type:"events"};this.event_arr=this.event_arr?this.event_arr:[];let n=Object.values(this.event_arr).findIndex(e=>new Date(e.date).toDateString()==a.date.toDateString());if(n>-1?(this.dispatchEvent(new CustomEvent("EventUpdate",{detail:{data:a,olddata:this.event_arr[n]},bubbles:!0,composed:!0})),a.action="update",this.event_arr[n]=a):(this.dispatchEvent(new CustomEvent("EventAdd",{detail:{data:a},bubbles:!0,composed:!0})),a.action="add",this.event_arr.push(a)),this.options&&this.options.eventSave)try{let r=new XMLHttpRequest;r.onload=function(){this.responseText},r.open("POST",t.options.eventSave),r.send(JSON.stringify(a))}catch(o){console.error(o)}return this.evtLoad(this.event_arr)};evtDelete=e=>{let t=this;if(!e)return console.error("Event Data Error!");if(!e.date)return console.error("Event date Error!");this.event_arr=this.event_arr?this.event_arr:[];let a=Object.values(this.event_arr).findIndex(t=>new Date(t.date).toDateString()==e.date.toDateString()),n=this.event_arr[a];if(n.action="delete",a>-1&&(this.event_arr[a]=[]),this.options&&this.options.eventSave)try{let r=new XMLHttpRequest;r.onload=function(){this.responseText},r.open("POST",t.options.eventSave),r.send(JSON.stringify(n))}catch(o){console.error(o)}return this.dispatchEvent(new CustomEvent("EventDelete",{detail:{data:e},bubbles:!0,composed:!0})),this.evtLoad(this.event_arr)};evtLoad=e=>{e=e&&"object"==typeof e?e:this.event_arr;let t=["events","offday"];return this.querySelectorAll(".cal-days>div").forEach(a=>{let n=Object.values(e).find(e=>new Date(e.date).toDateString()==new Date(a.date).toDateString());n&&n.title&&t.includes(n.type)?(a.classList.add(n.type),a.events=n):a.classList.remove("events")}),e};render(){this.awInit()}awInit(){let e=this,t=()=>{e.options.startDate=new Date(e.options.startDate),e.options.startDate.setHours(0,0,0,0),e.options.endDate=new Date(e.options.endDate),e.options.endDate.setHours(0,0,0,0),e.options.offDays=e.options.offDays?e.options.offDays:[],e.date<e.options.startDate&&(e.date.setFullYear(e.options.startDate.getFullYear()),e.date.setMonth(e.options.startDate.getMonth())),e.date>e.options.endDate&&(e.date.setFullYear(e.options.endDate.getFullYear()),e.date.setMonth(e.options.endDate.getMonth()));let a=new Date(e.date.getFullYear(),e.date.getMonth(),1).getDay(),n=new Date(e.date.getFullYear(),e.date.getMonth()+1,0),r=n.getDay(),o=n.getDate(),i=new Date(e.date.getFullYear(),e.date.getMonth(),0).getDate();if(e.dispatchEvent(new CustomEvent("ChangeCal",{detail:{date:new Date(e.date.getFullYear(),e.date.getMonth(),1)},bubbles:!0,composed:!0})),e.innerHTML=`<style>*{font-family: 'Open Sans', sans-serif; box-sizing: border-box;}.calendar{width: 100%; /*100% 35rem; */ height: 100%; /*100% 45rem; */ min-width: 16rem; min-height: 16rem; color: white; font-size: 1.6rem; background-repeat: no-repeat !important; background-size: 100% 100% !important; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -o-user-select: none; user-select: none; position: relative;}.calendar *{z-index: 10;}.calendar .cal-background{position: absolute; background: url('img/07.jpeg'); background-repeat: no-repeat !important; background-size: 100% 100% !important; opacity: 0.9; box-sizing: content-box; width: 100%; height: 100%; -webkit-filter: blur(5px); -moz-filter: blur(5px); -o-filter: blur(5px); -ms-filter: blur(5px); filter: blur(2px) brightness(0.5); z-index: 9;}.calendar>.cal-header{width: 100%; height: 15%; /* 7rem 20%; */ background: -moz-linear-gradient(to bottom, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0.3) 100%); background: -webkit-linear-gradient(to bottom, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0.3) 100%); background: linear-gradient(to bottom, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0.3) 100%); display: flex; justify-content: space-between; align-items: center; text-align: center; text-shadow: 0.1rem 0.2rem 0.1rem black;}.calendar>.cal-header>.title>.month-title{font-size: 70%; text-transform: uppercase; -webkit-animation: xscale-anim-02s 0.2s; -moz-animation: xscale-anim-02s 0.2s; -o-animation: xscale-anim-02s 0.2s; -ms-transition: xscale-anim-02s 0.2s; animation: xscale-anim-02s 0.2s;}.calendar>.cal-header>.title>.month-sub-title{font-size: 50%; -webkit-animation: xscale-anim-02s 0.2s; -moz-animation: xscale-anim-02s 0.2s; -o-animation: xscale-anim-02s 0.2s; -ms-transition: xscale-anim-02s 0.2s; animation: xscale-anim-02s 0.2s;}.calendar>.cal-header>.prevBtn, .calendar>.cal-header>.nextBtn{height: 100%; font-size: 100%; font-weight: 800; padding: 1rem 1.5rem; cursor: pointer; text-shadow: 0.1rem 0.2rem 0.1rem black; display: flex; justify-content: center; align-items: center;}.calendar>.cal-header>.prevBtn:hover{color: #c7c3c3; background: -moz-linear-gradient(to right, rgba(0, 0, 0, 0.3) 0%, rgba(0, 0, 0, 0) 100%); background: -webkit-linear-gradient(to right, rgba(0, 0, 0, 0.3) 0%, rgba(0, 0, 0, 0) 100%); background: linear-gradient(to right, rgba(0, 0, 0, 0.3) 0%, rgba(0, 0, 0, 0) 100%);}.calendar>.cal-header>.nextBtn:hover{color: #c7c3c3; background: -moz-linear-gradient(to left, rgba(0, 0, 0, 0.3) 0%, rgba(0, 0, 0, 0) 100%); background: -webkit-linear-gradient(to left, rgba(0, 0, 0, 0.3) 0%, rgba(0, 0, 0, 0) 100%); background: linear-gradient(to left, rgba(0, 0, 0, 0.3) 0%, rgba(0, 0, 0, 0) 100%);}.calendar>.cal-weeks{width: 100%; height: 8%; /* 2.6rem 10% */ display: flex; text-align: center; background: rgba(0, 0, 0, 0.7); /*rgba(94, 69, 69, 0.8) */ font-size: 50%;}.calendar>.cal-weeks>div{width: calc(100%/7); height: 100%; min-height: 1.5rem; display: flex; justify-content: center; align-items: center; text-shadow: 0.1rem 0.2rem 0.1rem black; box-shadow: 0.1rem 0.1rem 0.1rem rgb(255 255 255 / 10%);}.calendar>.cal-weeks>div:hover{background: rgba(107, 107, 107, 0.3); /* #5a4545 */ border-radius: 0.2rem;}.calendar>.cal-weeks>div.offday{color: #ff8383;}.calendar>.cal-days{width: 100%; height: 77%; /* 27.3rem 70% */ display: flex; flex-wrap: wrap; background: rgba(0, 0, 0, 0.7); /*rgba(74, 55, 55, 1)*/}.calendar>.cal-days>div{margin: 0.03rem 0; width: calc(100%/7); height: calc(96%/6); min-height: 2rem; display: flex; justify-content: center; align-items: center; cursor: pointer; text-shadow: 0.1rem 0.2rem 0.1rem black; box-shadow: 0.1rem 0.1rem 0.1rem rgba(255,255,255,0.05); transition: all 0.8s; font-size: 50%;}.calendar>.cal-days>div>span{-webkit-animation: yscale-anim-02s 0.2s; -moz-animation: yscale-anim-02s 0.2s; -o-animation: yscale-anim-02s 0.2s; -ms-transition: yscale-anim-02s 0.2s; animation: yscale-anim-02s 0.2s;}@keyframes yscale-anim-02s{from{-webkit-transform: scale(0,1);}to{-webkit-transform: scale(1,1);}}@keyframes xscale-anim-02s{from{-webkit-transform: scale(1,0);}to{-webkit-transform: scale(1,1);}}.calendar>.cal-days>div.today{background: rgba(107, 107, 107, 0.2); /* #725555 */; border-radius: 0.2rem;}.calendar>.cal-days>div.offday{color: #ff8383;}.calendar>.cal-days>div.events:after{content: ''; position: absolute; margin-right: -1.5rem; margin-top: -1.5rem; height: 0.5rem; width: 0.5rem; background: rgba(255, 0, 0, 0.7); border-radius: 50%; -webkit-animation: zoom-anim 0.5s; -moz-animation: zoom-anim 0.5s; -o-animation: zoom-anim 0.5s; -ms-transition: zoom-anim 0.5s; animation: yszoom-anim 0.5s;}@keyframes zoom-anim{from{-webkit-transform: scale(0,0);}to{-webkit-transform: scale(1,1);}}.calendar>.cal-days>div:hover:not(.today), .calendar>.cal-days>div.hover{background: rgba(107, 107, 107, 0.3); /* #5a4545 */ border-radius: 0.2rem;}.calendar>.cal-days>div.prevdays:not(.offday), .calendar>.cal-days>div.nextdays:not(.offday){color: #919191;}.calendar>.cal-days>div.disableday{color: rgba(255,255,255,0.2) !important; text-shadow: none;}</style> <div class="calendar"> <div class="cal-background"></div><div class="cal-header"> <div class="prevBtn"><</div><div class="title"> <div class="month-title"></div><div class="month-sub-title"></div></div><div class="nextBtn">></div></div><div class="cal-weeks"> </div><div class="cal-days"> </div></div><style>.eventModal{display: block; left: 0; top: 0; position: fixed; height: 100%; width: 100%; background-color: rgba(0,0,0,0.4); z-index: 9999;}.eventModal[role="show"]{display: block;}.eventModal[role="hide"]{display: none;}.eventModal>.modal-content{margin: 10rem auto; width: 80%; background-color: white; border-radius: 0.2rem; padding: 1rem 2rem; box-shadow: 0.05rem 0.05rem 0.2rem black; float: none !important;}.eventModal[role="show"]>.modal-content{-webkit-animation: scale-anim-02s 0.2s; -moz-animation: scale-anim-02s 0.2s; -o-animation: scale-anim-02s 0.2s; -ms-transition: scale-anim-02s 0.2s; animation: scale-anim-02s 0.2s;}.eventModal[role="hide"]>.modal-content{-webkit-animation: scale-anim-02s 0.2s; -moz-animation: scale-anim-02s 0.2s; -o-animation: scale-anim-02s 0.2s; -ms-transition: scale-anim-02s 0.2s; animation: scale-anim-02s 0.2s;}@keyframes scale-anim-02s{from{-webkit-transform: scale(0,0);}to{-webkit-transform: scale(1,1);}}.eventModal>.modal-content>.modal-header{width: 100%; display: flex; justify-content: space-between; align-items: center;}.eventModal>.modal-content>.modal-header>.close{font-size: 1.7rem; font-weight: 600; cursor: pointer;}.eventModal>.modal-content>.modal-body{width: 100%;}.form-body{border-radius: 0.5rem; background-color: #f2f2f2 !important; padding: 2rem;}.form-input{}.form-input button{font-size: 1.2rem; background-color: #4CAF50; color: white; padding: 1rem 1.2rem; border: none; border-radius: 0.4rem; cursor: pointer; float: right; margin: 0.4rem;}.form-input button:hover{background-color: #45a049;}.form-input input,.form-input textarea,.form-input select{font-size: 1rem; margin: 10px; width: 100%; padding: 0.8rem 1rem; border: 0.1rem solid #ccc; text-shadow: 0.03rem 0.03rem 0.1rem black; outline:none; resize: vertical;}.form-input label{padding: 1rem ; display: inline-block;}.form-input input:focus,.form-input textarea:focus,.form-input select:focus{border-bottom: 0.1rem solid rgba(0,0,0,0.8); border-left: 0.01rem solid rgba(0,0,0,0.3); border-right: 0.01rem solid rgba(0,0,0,0.3);}.col-25{float: left; width: 25%; margin-top: 6px;}.col-75{float: left; width: 75%; margin-top: 6px;}.row:after{content: ""; display: table; clear: both;}@media screen and (max-width: 600px){.col-25, .col-75, input[type=submit]{width: 100%; margin-top: 0;}}</style> <div class="eventModal modal" role="hide"> <div class="modal-content form-body col-75 "> <div class="modal-header"> <h3>Event Form</h3> <span class="close">&times;</span> </div><div class="modal-body"> <form action="" method="post"> <input type="hidden" name="date" placeholder="Date"/> <div class="row form-input"> <div class="col-25"> <label for="fname">Title</label> </div><div class="col-75"> <input type="text" name="title" placeholder="Title"/> </div></div><div class="row form-input"> <div class="col-25"> <label for="fname">Description</label> </div><div class="col-75"> <textarea name="description" placeholder="Description"></textarea> </div></div><div class="row form-input" style="display: block;"> <button name="addEvent" type="button">Add Event</button> <button name="deleteEvent" type="button">Delete</button> </div></form> </div></div></div>`,e.options.backgroundColor?e.querySelector(".calendar .cal-background").style.background=`${e.options.backgroundColor}`:e.options.backgroundImg?e.querySelector(".calendar .cal-background").style.background=`url('${e.options.backgroundImg}')`:e.querySelector(".calendar .cal-background").style.background="#262626",this.week_names=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Object.values(this.week_names).map((t,a)=>{let n=e.options.offDays.includes(a)?"offday":"",r=document.createElement("div");n&&r.classList.add(`${n}`),r.week=`${a}`,r.classList.add(`week-${a}`),r.innerHTML=`${t}`,e.querySelector(".cal-weeks").append(r)}),e.querySelector(".cal-header>.title>.month-title").innerHTML=`${e.date.toLocaleString("en-US",{month:"long"})}`,e.querySelector(".cal-header>.title>.month-sub-title").innerHTML=`${e.date.toLocaleString("en-US",{year:"numeric"})}`,e.options.eventLoad)try{let s=new XMLHttpRequest;s.onload=function(){let t=JSON.parse(this.responseText);t=t&&"object"==typeof t?t:[],t=Object.values(t).map((e,t)=>(e.date=new Date(e.date),e)),e.event_arr=t||[],e.evtLoad(e.event_arr)};let d={str_date:e.dateFormat(e.options.startDate,"yyyy-MM-dd"),end_date:e.dateFormat(e.options.endDate,"yyyy-MM-dd")};s.open("POST",e.options.eventLoad),s.send(JSON.stringify(d))}catch(l){console.error(l)}let c=e.querySelector(".cal-days");for(let $=parseInt(a-1);$>=0;$--){let m=new Date(e.date.getFullYear(),e.date.getMonth()-1,i-$,0,0,0),u=[];u.push("week-"+m.getDay()),u.push("prevdays"),u.push(e.options.offDays.includes(m.getDay())?"offday":"");let h=document.createElement("div");h.setAttribute("class",`${u.join(" ")}`),h.setAttribute("date",`${m}`),h.setAttribute("title",`${m.toDateString()}`),h.date=`${m}`;let p=document.createElement("span");p.innerHTML=`${m.getDate()}`,h.append(p),c.append(h)}for(let v=0;v<o;v++){let g=new Date(e.date.getFullYear(),e.date.getMonth(),v+1,0,0,0),b=[];b.push("week-"+g.getDay()),b.push(e.options.offDays.includes(g.getDay())?"offday":"");let y=document.createElement("div");y.setAttribute("class",`${b.join(" ")}`),y.setAttribute("date",`${g}`),y.setAttribute("title",`${g.toDateString()}`),y.date=`${g}`;let f=document.createElement("span");f.innerHTML=`${g.getDate()}`,y.append(f),c.append(y)}let w=6>Math.floor((a+o)/6)?7:0;for(let _=0;_<6+w-r;_++){let k=new Date(e.date.getFullYear(),e.date.getMonth()+1,_+1,0,0,0),D=[];D.push("week-"+k.getDay()),D.push("nextdays"),D.push(e.options.offDays.includes(k.getDay())?"offday":"");let x=document.createElement("div");x.setAttribute("class",`${D.join(" ")}`),x.setAttribute("date",`${k}`),x.setAttribute("title",`${k.toDateString()}`),x.date=`${k}`;let S=document.createElement("span");S.innerHTML=`${k.getDate()}`,x.append(S),c.append(x)}if(e.setToday(e.today),e.prenxtDisableDays(e.options.startDate,e.options.endDate),e.querySelector(".calendar>.cal-header>.prevBtn").addEventListener("click",()=>{e.date.setMonth(e.date.getMonth()-1),t()}),e.querySelector(".calendar>.cal-header>.nextBtn").addEventListener("click",()=>{e.date.setMonth(e.date.getMonth()+1),t()}),e.querySelectorAll(".cal-weeks>div").forEach(t=>{t.addEventListener("mouseover",a=>{e.querySelectorAll(`.cal-days>div.week-${t.week}`).forEach(e=>{e.classList.add("hover")})}),t.addEventListener("mouseout",t=>{e.querySelectorAll(".cal-days>div").forEach(e=>{e.classList.remove("hover")})})}),e.querySelectorAll(".cal-days>div:not(.disableday)").forEach(t=>{t.addEventListener("click",a=>{let n=new Date(t.date),r=t.events?t.events:[];if(e.options&&e.options.eventModal){let o=r&&r.title?r.title:"",i=r&&r.description?r.description:"";e.querySelector(".eventModal input[name='date']").value=e.dateFormat(n,"yyyy-MM-dd"),e.querySelector(".eventModal input[name='title']").value=o,e.querySelector(".eventModal textarea[name='description']").value=i,e.querySelector(".eventModal").setAttribute("role","show")}e.dispatchEvent(new CustomEvent("SelectDate",{detail:{date:n,events:r},bubbles:!0,composed:!0}))})}),e.querySelector(".eventModal .close").addEventListener("click",t=>{e.querySelector(".eventModal").setAttribute("role","hide")}),e.querySelector(".eventModal button[name='addEvent']").addEventListener("click",t=>{let a=new Date(e.querySelector(".eventModal input[name='date']").value),n=e.querySelector(".eventModal input[name='title']").value,r=e.querySelector(".eventModal textarea[name='description']").value;e.evtAdd({date:a,title:n,description:r,type:"events"}),e.querySelector(".eventModal").setAttribute("role","hide")}),e.querySelector(".eventModal button[name='deleteEvent']").addEventListener("click",t=>{let a=new Date(e.querySelector(".eventModal input[name='date']").value);e.evtDelete({date:a}),e.querySelector(".eventModal").setAttribute("role","hide")}),e.new_options&&Object.values(e.new_options).length>0){let M=Object.assign({},e.new_options);e.dispatchEvent(new CustomEvent("SetData",{detail:M,bubbles:!0,composed:!0}))}e.new_options=[]};t()}}window.customElements.define("aw-calendar",awCalendar);